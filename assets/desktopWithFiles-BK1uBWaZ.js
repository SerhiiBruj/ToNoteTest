import{e as b,j as e,P as C,r as i,a as $,u as F,f as k,g as D,h as w,c as I,b as A,m as E,C as B}from"./index-Dsw0a0sa.js";import{B as P}from"./bellsIcon-DBB7R4ER.js";const L=({isSelected:t})=>{const{isSelecting:l}=b(m=>m.select);return e.jsx("div",{className:"selcirc",style:{transform:l?"none":"scale(0)",opacity:l?1:0},children:e.jsx("div",{className:"selectCircle",style:{background:t?"rgb(46 46 46 )":"none"}})})},T=t=>{const{boolAnimate:l,setBoolAnimate:m}=t,n=b(a=>a.isEditable.value),{isSelecting:h,selected:d}=b(a=>a.select),c=$(),s=i.useRef(),f=F(),[u,p]=i.useState(t.name),g=k();i.useEffect(()=>{p(t.name)},[t.name]);const o=i.useCallback(a=>{a.stopPropagation();const r=`${t.type}/${u}`;d.includes(r)?c(w(r)):c(D(r))},[u,t.type,d]);i.useLayoutEffect(()=>{s.current&&l&&(s.current.style.transition="all ease 0.5s",s.current.style.opacity="0%",s.current.style.transform="scale(0)")},[l]);const x=a=>{p(a.target.value)},y=async(a,r)=>{if(typeof r!="string"||!r.trim()||r===a){p(a.split("/")[1]),console.log("Новий ключ не може бути порожнім або таким самим.");return}if(Object.keys(sessionStorage).includes(r)){console.log(`Ключ "${r}" вже існує.`);return}let N=sessionStorage.getItem(a)||localStorage.getItem(a);if(N!==null)try{if(localStorage.getItem(a)&&(localStorage.setItem(r,N),localStorage.removeItem(a),c(I(Object.keys(sessionStorage)))),sessionStorage.getItem(a)){sessionStorage.setItem(r,N),sessionStorage.removeItem(a);const S=localStorage.getItem("token");if(!S){console.log("Токен не знайдено, будь ласка, увійдіть у систему.");return}if(!localStorage.getItem("beLocal"))try{const v=await A.post("http://"+E+":3000/rename-uploaded-file",{rnfile:a,newName:r},{headers:{authorization:`Bearer ${S}`}});v.status===200?(console.log("Файл успішно перейменовано"),c(I(Object.keys(sessionStorage)))):console.log("Сталася помилка при перейменуванні файлу:",v.data)}catch(v){console.error("Помилка при зверненні до сервера:",v),alert("Сталася помилка при зверненні до сервера.")}}}catch(S){console.error("Помилка при перейменуванні файлу:",S),alert("Не вдалося перейменувати файл.")}else console.log(`Ключ "${a}" не знайдено.`)},j=i.useCallback(()=>{s.current&&(s.current.style.transition="all ease 0.4s",s.current.style.transform="scale(1.2)",setTimeout(()=>{s.current.style.backgroundColor="#1e1e1e",s.current.style.transform="scale(0)",setTimeout(()=>{m(!0),setTimeout(()=>{f(`${t.type}/${t.name}`)},300)},100)},400))},[f,t.name,t.type,c]);return e.jsx("div",{ref:s,className:g<500?" fileIconConteinerOptim ":"fileIconConteiner",role:"button",tabIndex:0,onClick:a=>{a.stopPropagation(),!h&&!n?j():h&&o(a)},onBlur:()=>n&&y(`${t.type}/${t.name}`,`${t.type}/${u}`),children:!l&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{height:"70%",overflow:"hidden"},children:[e.jsx("input",{style:{pointerEvents:n?"all":"none",transition:"0.2s all ease",animation:t.name.length>16&&!n?"scrollText 6s linear infinite":"none"},onChange:x,className:`texarea fileIconName ${t.name.length>16&&"scroll-container"}`,disabled:!n,value:n?u:t.name}),e.jsx("span",{className:"fileIconType",children:t.type})]}),e.jsxs("div",{style:{display:"flex",height:"30%",alignItems:"flex-end",justifyContent:"space-between"},children:[e.jsx("div",{children:e.jsx(L,{isSelected:d.some(a=>a===`${t.type}/${u}`)})}),e.jsx("div",{style:{display:t.type==="todo"||t.type==="dashboard"||t.type===""?"flex":"none"},children:e.jsx(P,{size:1.3})})]})]})})};T.propTypes={name:C.string.isRequired,type:C.string.isRequired};const O=i.memo(T),R=({size:t,checked:l})=>e.jsx("div",{className:"selcirc",style:{height:`${t}px !important `,width:`${t}px !important `},children:e.jsx("div",{className:"selectCircle",style:{background:l?"rgb(46 46 46 )":"none"}})}),z=t=>t.replace(/[/"'\\%]/g,""),W=t=>{const l=k(),{boolAnimate:m}=t,n=i.useRef(null),h=$(),[d,c]=i.useState(!1),[s,f]=i.useState({fileName:"",fileType:"note",local:!1});i.useLayoutEffect(()=>{n.current&&m&&(n.current.style.transition="all ease 0.5s",n.current.style.opacity="0%",n.current.style.transform="scale(0)")},[m]);const u=i.useCallback(g=>{const{name:o,value:x}=g.target;f(y=>({...y,[o]:z(x)}))},[]),p=i.useCallback(g=>{if(g.preventDefault(),s.fileName.trim()===""){alert("Please enter a file name");return}let o=new Date;const x=(()=>{switch(s.fileType){case"todo":return[];case"diary":return[{date:`${String(o.getDate()).padStart(2,"0")}.${String(o.getMonth()+1).padStart(2,"0")}.${o.getFullYear()}`,value:""}];case"note":return"";case"table":return[[s.fileName,""],["",""]];case"checklist":return[];case"dashboard":return{templates:[],table:[[`${String(o.getDate()).padStart(2,"0")}.${String(o.getMonth()+1).padStart(2,"0")}.${o.getFullYear()}`]]};default:return null}})(),y=JSON.stringify(x),j=`${s.fileType}/${s.fileName}`;localStorage.getItem("beLocal")!==null||s.local?localStorage.setItem(j,y):sessionStorage.setItem(j,y),c(!1),f({fileName:"",fileType:"note"}),h(I())},[s.fileName,s.fileType,s.local]);return e.jsxs("div",{onClick:()=>c(!0),ref:n,className:l<500?"fileIconConteinerOptim addFile":"fileIconConteiner addFile",style:{height:d&&(l>500?350:"58dvw "),width:d&&(l>500?300:"47dvw")},children:[e.jsxs("div",{className:"upperside",children:[e.jsx("span",{className:"fileIconName",children:"Add"}),e.jsx("div",{onBlur:()=>c(!1),onClick:g=>{g.stopPropagation(),c(o=>!o),f({fileName:"",fileType:"note"})},style:{display:"flex",height:"100%",transition:"all 0.6s ease",alignItems:"center",paddingRight:20,transform:d?"rotate(45deg)":"rotate(0deg) translateY(15px)  translateX(-20px)"},children:e.jsx(B,{color:"#D9D9D9",size:d?.056:.08})})]}),d&&e.jsxs("form",{onSubmit:p,style:{width:"100%",marginTop:10},children:[e.jsx("input",{className:"fileName",name:"fileName",placeholder:"Name",value:s.fileName,onChange:u}),e.jsxs("select",{className:"fileType",name:"fileType",value:s.fileType,onChange:u,children:[e.jsx("option",{value:"note",children:"note"}),e.jsx("option",{value:"todo",children:"todo"}),e.jsx("option",{value:"table",children:"table"}),e.jsx("option",{value:"dashboard",children:"dashboard"}),e.jsx("option",{value:"checklist",children:"checklist"}),e.jsx("option",{value:"diary",children:"diary"})]}),e.jsxs("label",{htmlFor:"fd",className:"fileIconName",style:{fontSize:25,display:"inline-flex",alignItems:"center",justifyContent:"center"},children:["Save Locally",e.jsx("div",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",height:"100%",width:50},onClick:()=>{f({...s,local:!s.local})},children:e.jsx(R,{size:10,checked:s.local})})]}),e.jsx("button",{type:"submit",className:"submit",children:"Create"})]})]})},Y=i.memo(W),q=()=>{const[t,l]=i.useState(!1),m=b(n=>n.pages.value);return i.useEffect(()=>{console.log("useEffect"),t&&setTimeout(()=>{l(!1)},500)},[t,l]),e.jsx("div",{style:{width:"100%",display:"flex"},children:e.jsxs("div",{className:"desktopWithFiles",style:{height:"fit-content",background:"none"},children:[m.map((n,h)=>e.jsx(O,{setBoolAnimate:l,boolAnimate:t,name:n.split("/")[1],type:n.split("/")[0]},h)),e.jsx(Y,{setBoolAnimate:l,boolAnimate:t})]})})},V=i.memo(q);export{V as default};
