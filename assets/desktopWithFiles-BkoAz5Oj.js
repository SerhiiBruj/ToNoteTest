import{e as b,j as t,r as n,P as C,a as $,u as T,f as F,g as D,c as I,b as E,m as A,C as z}from"./index-7NQkEwYn.js";import{B}from"./bellsIcon--mtbk-iG.js";const L=({isSelected:e})=>{const{isSelecting:l}=b(d=>d.select);return t.jsx("div",{className:"selcirc",style:{transform:l?"none":"scale(0)",opacity:l?1:0},children:t.jsx("div",{className:"selectCircle",style:{background:e?"rgb(46 46 46 )":"none"}})})},k=()=>{const[e,l]=n.useState(window.innerWidth),[d,i]=n.useState(null),u=()=>{clearTimeout(d);let c=setTimeout(()=>{console.log("resize"),l(window.innerWidth)},1e3);i(c)};return n.useEffect(()=>(window.addEventListener("resize",u),()=>window.removeEventListener("resize",u)),[]),e},w=e=>{const{boolAnimate:l,setBoolAnimate:d}=e,i=b(a=>a.isEditable.value),{isSelecting:u,selected:c}=b(a=>a.select),m=$(),s=n.useRef(),g=T(),[f,p]=n.useState(e.name),h=k();n.useEffect(()=>{p(e.name)},[e.name]);const o=n.useCallback(a=>{a.stopPropagation();const r=`${e.type}/${f}`;c.includes(r)?m(D(r)):m(F(r))},[f,e.type,c]);n.useLayoutEffect(()=>{s.current&&l&&(s.current.style.transition="all ease 0.5s",s.current.style.opacity="0%",s.current.style.transform="scale(0)")},[l]);const x=a=>{p(a.target.value)},y=async(a,r)=>{if(typeof r!="string"||!r.trim()||r===a){p(a.split("/")[1]),console.log("Новий ключ не може бути порожнім або таким самим.");return}if(Object.keys(sessionStorage).includes(r)){console.log(`Ключ "${r}" вже існує.`);return}let N=sessionStorage.getItem(a)||localStorage.getItem(a);if(N!==null)try{if(localStorage.getItem(a)&&(localStorage.setItem(r,N),localStorage.removeItem(a),m(I(Object.keys(sessionStorage)))),sessionStorage.getItem(a)){sessionStorage.setItem(r,N),sessionStorage.removeItem(a);const j=localStorage.getItem("token");if(!j){console.log("Токен не знайдено, будь ласка, увійдіть у систему.");return}if(!localStorage.getItem("beLocal"))try{const S=await E.post("http://"+A+":3000/rename-uploaded-file",{rnfile:a,newName:r},{headers:{authorization:`Bearer ${j}`}});S.status===200?(console.log("Файл успішно перейменовано"),m(I(Object.keys(sessionStorage)))):console.log("Сталася помилка при перейменуванні файлу:",S.data)}catch(S){console.error("Помилка при зверненні до сервера:",S),alert("Сталася помилка при зверненні до сервера.")}}}catch(j){console.error("Помилка при перейменуванні файлу:",j),alert("Не вдалося перейменувати файл.")}else console.log(`Ключ "${a}" не знайдено.`)},v=n.useCallback(()=>{s.current&&(s.current.style.transition="all ease 0.4s",s.current.style.transform="scale(1.2)",setTimeout(()=>{s.current.style.backgroundColor="#1e1e1e",s.current.style.transform="scale(0)",setTimeout(()=>{d(!0),setTimeout(()=>{g(`${e.type}/${e.name}`)},300)},100)},400))},[g,e.name,e.type,m]);return t.jsx("div",{ref:s,className:h<500?" fileIconConteinerOptim ":"fileIconConteiner",role:"button",tabIndex:0,onClick:a=>{a.stopPropagation(),!u&&!i?v():u&&o(a)},onBlur:()=>i&&y(`${e.type}/${e.name}`,`${e.type}/${f}`),children:!l&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{style:{height:"70%",overflow:"hidden"},children:[t.jsx("input",{style:{pointerEvents:i?"all":"none",transition:"0.2s all ease",animation:e.name.length>16&&!i?"scrollText 6s linear infinite":"none"},onChange:x,className:`texarea fileIconName ${e.name.length>16&&"scroll-container"}`,disabled:!i,value:i?f:e.name}),t.jsx("span",{className:"fileIconType",children:e.type})]}),t.jsxs("div",{style:{display:"flex",height:"30%",alignItems:"flex-end",justifyContent:"space-between"},children:[t.jsx("div",{children:t.jsx(L,{isSelected:c.some(a=>a===`${e.type}/${f}`)})}),t.jsx("div",{style:{display:e.type==="todo"||e.type==="dashboard"||e.type===""?"flex":"none"},children:t.jsx(B,{size:1.3})})]})]})})};w.propTypes={name:C.string.isRequired,type:C.string.isRequired};const W=n.memo(w),P=({size:e,checked:l})=>t.jsx("div",{className:"selcirc",style:{height:`${e}px !important `,width:`${e}px !important `},children:t.jsx("div",{className:"selectCircle",style:{background:l?"rgb(46 46 46 )":"none"}})}),O=e=>e.replace(/[/"'\\%]/g,""),R=e=>{const l=k(),{boolAnimate:d}=e,i=n.useRef(null),u=$(),[c,m]=n.useState(!1),[s,g]=n.useState({fileName:"",fileType:"note",local:!1});n.useLayoutEffect(()=>{i.current&&d&&(i.current.style.transition="all ease 0.5s",i.current.style.opacity="0%",i.current.style.transform="scale(0)")},[d]);const f=n.useCallback(h=>{const{name:o,value:x}=h.target;g(y=>({...y,[o]:O(x)}))},[]),p=n.useCallback(h=>{if(h.preventDefault(),s.fileName.trim()===""){alert("Please enter a file name");return}let o=new Date;const x=(()=>{switch(s.fileType){case"todo":return[];case"diary":return[{date:`${String(o.getDate()).padStart(2,"0")}.${String(o.getMonth()+1).padStart(2,"0")}.${o.getFullYear()}`,value:""}];case"note":return"";case"table":return[[s.fileName,""],["",""]];case"checklist":return[];case"dashboard":return{templates:[],table:[[`${String(o.getDate()).padStart(2,"0")}.${String(o.getMonth()+1).padStart(2,"0")}.${o.getFullYear()}`]]};default:return null}})(),y=JSON.stringify(x),v=`${s.fileType}/${s.fileName}`;localStorage.getItem("beLocal")!==null||s.local?localStorage.setItem(v,y):sessionStorage.setItem(v,y),m(!1),g({fileName:"",fileType:"note"}),u(I())},[s.fileName,s.fileType,s.local]);return t.jsxs("div",{onClick:()=>m(!0),ref:i,className:l<500?"fileIconConteinerOptim addFile":"fileIconConteiner addFile",style:{height:c&&(l>500?"24dvw ":"58dvw "),width:c&&(l>500?"22dvw ":"47dvw")},children:[t.jsxs("div",{className:"upperside",children:[t.jsx("span",{className:"fileIconName",children:"Add"}),t.jsx("div",{onBlur:()=>m(!1),onClick:h=>{h.stopPropagation(),m(o=>!o),g({fileName:"",fileType:"note"})},style:{display:"flex",height:"100%",transition:"all 0.6s ease",alignItems:"center",paddingRight:20,transform:c?"rotate(45deg)":"rotate(0deg) translateY(15px)  translateX(-20px)"},children:t.jsx(z,{color:"#D9D9D9",size:c?.056:.08})})]}),c&&t.jsxs("form",{onSubmit:p,style:{width:"100%",marginTop:10},children:[t.jsx("input",{className:"fileName",name:"fileName",placeholder:"Name",value:s.fileName,onChange:f}),t.jsxs("select",{className:"fileType",name:"fileType",value:s.fileType,onChange:f,children:[t.jsx("option",{value:"note",children:"note"}),t.jsx("option",{value:"todo",children:"todo"}),t.jsx("option",{value:"table",children:"table"}),t.jsx("option",{value:"dashboard",children:"dashboard"}),t.jsx("option",{value:"checklist",children:"checklist"}),t.jsx("option",{value:"diary",children:"diary"})]}),t.jsxs("label",{htmlFor:"fd",className:"fileIconName",style:{fontSize:25,display:"inline-flex",alignItems:"center",justifyContent:"center"},children:["Save Locally",t.jsx("div",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",height:"100%",width:50},onClick:()=>{g({...s,local:!s.local})},children:t.jsx(P,{size:10,checked:s.local})})]}),t.jsx("button",{type:"submit",className:"submit",children:"Create"})]})]})},Y=n.memo(R),q=()=>{const[e,l]=n.useState(!1),d=b(i=>i.pages.value);return n.useEffect(()=>{console.log("useEffect"),e&&setTimeout(()=>{l(!1)},500)},[e,l]),t.jsx("div",{style:{width:"100%",display:"flex"},children:t.jsxs("div",{className:"desktopWithFiles",style:{height:"fit-content",background:"none"},children:[d.map((i,u)=>t.jsx(W,{setBoolAnimate:l,boolAnimate:e,name:i.split("/")[1],type:i.split("/")[0]},u)),t.jsx(Y,{setBoolAnimate:l,boolAnimate:e})]})})},V=n.memo(q);export{V as default};
