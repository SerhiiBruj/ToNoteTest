import{e as b,j as e,P as I,r as l,a as C,u as k,f as T,g as D,c as N,b as F,m as A,C as E}from"./index-Ddb9vk37.js";import{B}from"./bellsIcon-D_tft2Cq.js";const P=({isSelected:t})=>{const{isSelecting:n}=b(d=>d.select);return e.jsx("div",{className:"selcirc",style:{transform:n?"none":"scale(0)",opacity:n?1:0},children:e.jsx("div",{className:"selectCircle",style:{background:t?"rgb(46 46 46 )":"none"}})})},$=t=>{const{boolAnimate:n,setBoolAnimate:d}=t,o=b(s=>s.isEditable.value),{isSelecting:m,selected:f}=b(s=>s.select),a=C(),i=l.useRef(),y=k(),[g,u]=l.useState(t.name);l.useEffect(()=>{u(t.name)},[t.name]);const r=l.useCallback(s=>{s.stopPropagation();const c=`${t.type}/${g}`;f.includes(c)?a(D(c)):a(T(c))},[g,t.type,f]);l.useLayoutEffect(()=>{i.current&&n&&(i.current.style.transition="all ease 0.5s",i.current.style.opacity="0%",i.current.style.transform="scale(0)")},[n]);const p=s=>{u(s.target.value)},h=async(s,c)=>{if(typeof c!="string"||!c.trim()||c===s){u(s.split("/")[1]),console.log("Новий ключ не може бути порожнім або таким самим.");return}if(Object.keys(sessionStorage).includes(c)){console.log(`Ключ "${c}" вже існує.`);return}let v=sessionStorage.getItem(s)||localStorage.getItem(s);if(v!==null)try{if(localStorage.getItem(s)&&(localStorage.setItem(c,v),localStorage.removeItem(s),a(N(Object.keys(sessionStorage)))),sessionStorage.getItem(s)){sessionStorage.setItem(c,v),sessionStorage.removeItem(s);const j=localStorage.getItem("token");if(!j){console.log("Токен не знайдено, будь ласка, увійдіть у систему.");return}if(!localStorage.getItem("beLocal"))try{const S=await F.post("http://"+A+":3000/rename-uploaded-file",{rnfile:s,newName:c},{headers:{authorization:`Bearer ${j}`}});S.status===200?(console.log("Файл успішно перейменовано"),a(N(Object.keys(sessionStorage)))):console.log("Сталася помилка при перейменуванні файлу:",S.data)}catch(S){console.error("Помилка при зверненні до сервера:",S),alert("Сталася помилка при зверненні до сервера.")}}}catch(j){console.error("Помилка при перейменуванні файлу:",j),alert("Не вдалося перейменувати файл.")}else console.log(`Ключ "${s}" не знайдено.`)},x=l.useCallback(()=>{i.current&&(i.current.style.transition="all ease 0.4s",i.current.style.transform="scale(1.2)",setTimeout(()=>{i.current.style.backgroundColor="#1e1e1e",i.current.style.transform="scale(0)",setTimeout(()=>{d(!0),setTimeout(()=>{y(`${t.type}/${t.name}`)},300)},100)},400))},[y,t.name,t.type,a]);return e.jsx("div",{ref:i,className:"fileIconConteiner",role:"button",tabIndex:0,onClick:s=>{s.stopPropagation(),!m&&!o?x():m&&r(s)},onBlur:()=>o&&h(`${t.type}/${t.name}`,`${t.type}/${g}`),children:!n&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{height:"70%",overflow:"hidden"},children:[e.jsx("input",{style:{pointerEvents:o?"all":"none",transition:"0.2s all ease",animation:t.name.length>16&&!o?"scrollText 6s linear infinite":"none"},onChange:p,className:`texarea fileIconName ${t.name.length>16&&"scroll-container"}`,disabled:!o,value:o?g:t.name}),e.jsx("span",{className:"fileIconType",children:t.type})]}),e.jsxs("div",{style:{display:"flex",height:"30%",alignItems:"flex-end",justifyContent:"space-between"},children:[e.jsx("div",{children:e.jsx(P,{isSelected:f.some(s=>s===`${t.type}/${g}`)})}),e.jsx("div",{style:{display:t.type==="todo"||t.type==="dashboard"||t.type===""?"flex":"none"},children:e.jsx(B,{size:1.3})})]})]})})};$.propTypes={name:I.string.isRequired,type:I.string.isRequired};const L=l.memo($),R=({size:t,checked:n})=>e.jsx("div",{className:"selcirc",style:{height:`${t}px !important `,width:`${t}px !important `},children:e.jsx("div",{className:"selectCircle",style:{background:n?"rgb(46 46 46 )":"none"}})}),z=t=>t.replace(/[/"'\\%]/g,""),w=t=>{const{boolAnimate:n}=t,d=l.useRef(null),o=C(),[m,f]=l.useState(!1),[a,i]=l.useState({fileName:"",fileType:"note",local:!1});l.useLayoutEffect(()=>{d.current&&n&&(d.current.style.transition="all ease 0.5s",d.current.style.opacity="0%",d.current.style.transform="scale(0)")},[n]);const y=l.useCallback(u=>{const{name:r,value:p}=u.target;i(h=>({...h,[r]:z(p)}))},[]),g=l.useCallback(u=>{if(u.preventDefault(),a.fileName.trim()===""){alert("Please enter a file name");return}let r=new Date;const p=(()=>{switch(a.fileType){case"todo":return[];case"diary":return[{date:`${String(r.getDate()).padStart(2,"0")}.${String(r.getMonth()+1).padStart(2,"0")}.${r.getFullYear()}`,value:""}];case"note":return"";case"table":return[[a.fileName,""],["",""]];case"checklist":return[];case"dashboard":return{templates:[],table:[[`${String(r.getDate()).padStart(2,"0")}.${String(r.getMonth()+1).padStart(2,"0")}.${r.getFullYear()}`]]};default:return null}})(),h=JSON.stringify(p),x=`${a.fileType}/${a.fileName}`;localStorage.getItem("beLocal")!==null||a.local?localStorage.setItem(x,h):sessionStorage.setItem(x,h),f(!1),i({fileName:"",fileType:"note"}),o(N())},[a.fileName,a.fileType,a.local]);return e.jsxs("div",{onClick:()=>f(!0),ref:d,className:"fileIconConteiner addFile",style:{height:m&&300,width:m&&340},children:[e.jsxs("div",{className:"upperside",children:[e.jsx("span",{className:"fileIconName",children:"Add"}),e.jsx("div",{onBlur:()=>f(!1),onClick:u=>{u.stopPropagation(),f(r=>!r),i({fileName:"",fileType:"note"})},style:{display:"flex",height:"100%",transition:"all 0.6s ease",alignItems:"center",paddingRight:20,transform:m?"rotate(45deg)":"rotate(0deg) translateY(15px)  translateX(-20px)"},children:e.jsx(E,{color:"#D9D9D9",size:m?.8:1.5})})]}),m&&e.jsxs("form",{onSubmit:g,style:{width:"100%",marginTop:10},children:[e.jsx("input",{className:"fileName",name:"fileName",placeholder:"Name",value:a.fileName,onChange:y}),e.jsxs("select",{className:"fileType",name:"fileType",value:a.fileType,onChange:y,children:[e.jsx("option",{value:"note",children:"note"}),e.jsx("option",{value:"todo",children:"todo"}),e.jsx("option",{value:"table",children:"table"}),e.jsx("option",{value:"dashboard",children:"dashboard"}),e.jsx("option",{value:"checklist",children:"checklist"}),e.jsx("option",{value:"diary",children:"diary"})]}),e.jsxs("label",{htmlFor:"fd",className:"fileIconName",style:{fontSize:25,display:"inline-flex",alignItems:"center",justifyContent:"center"},children:["Save Locally",e.jsx("div",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",height:"100%",width:50},onClick:()=>{i({...a,local:!a.local})},children:e.jsx(R,{size:10,checked:a.local})})]}),e.jsx("button",{type:"submit",className:"submit",children:"Create"})]})]})},O=l.memo(w),W=()=>{const[t,n]=l.useState(!1),d=b(o=>o.pages.value);return l.useEffect(()=>{console.log("useEffect"),t&&setTimeout(()=>{n(!1)},500)},[t,n]),e.jsx("div",{style:{width:"100%",display:"flex"},children:e.jsxs("div",{className:"desktopWithFiles",style:{height:"fit-content",background:"none"},children:[d.map((o,m)=>e.jsx(L,{setBoolAnimate:n,boolAnimate:t,name:o.split("/")[1],type:o.split("/")[0]},m)),e.jsx(O,{setBoolAnimate:n,boolAnimate:t})]})})},M=l.memo(W);export{M as default};
