import{e as f,j as e,P as N,r as n,a as b,u as $,f as k,g as T,h as F,c as v,b as D,m as A,C as E,i as P}from"./index-3Fa_xKCu.js";import{B}from"./bellsIcon-rzt5kmyN.js";const R=({isSelected:t})=>{const{isSelecting:r}=f(l=>l.select);return e.jsx("div",{className:"selcirc",style:{transform:r?"none":"scale(0)",opacity:r?1:0},children:e.jsx("div",{className:"selectCircle",style:{background:t?"rgb(46 46 46 )":"none"}})})},C=t=>{const r=f(s=>s.startAnimation.value),l=f(s=>s.isEditable.value),{isSelecting:o,selected:u}=f(s=>s.select),a=b(),i=n.useRef(),y=$(),[g,m]=n.useState(t.name);n.useEffect(()=>{m(t.name)},[t.name]);const d=n.useCallback(s=>{s.stopPropagation();const c=`${t.type}/${g}`;u.includes(c)?a(T(c)):a(k(c))},[u,a,g,t.type]);n.useEffect(()=>{i.current&&r&&(i.current.style.transition="all ease 0.5s",i.current.style.opacity="0%",i.current.style.transform="scale(0)")},[r]);const p=s=>{m(s.target.value)},h=async(s,c)=>{if(typeof c!="string"||!c.trim()||c===s){m(s.split("/")[1]),console.log("Новий ключ не може бути порожнім або таким самим.");return}if(Object.keys(sessionStorage).includes(c)){console.log(`Ключ "${c}" вже існує.`);return}let x=sessionStorage.getItem(s)||localStorage.getItem(s);if(x!==null){if(localStorage.getItem(s)&&(localStorage.setItem(c,x),localStorage.removeItem(s),a(v(Object.keys(sessionStorage)))),sessionStorage.getItem(s)){sessionStorage.setItem(c,x),sessionStorage.removeItem(s);const I=localStorage.getItem("token");if(!I){console.log("Токен не знайдено, будь ласка, увійдіть у систему.");return}if(!localStorage.getItem("beLocal"))try{const S=await D.post("http://"+A+":3000/rename-uploaded-file",{rnfile:s,newName:c},{headers:{authorization:`Bearer ${I}`}});S.status===200?(console.log("Файл успішно перейменовано"),a(v(Object.keys(sessionStorage)))):console.log("Сталася помилка при перейменуванні файлу:",S.data)}catch(S){console.error("Помилка при зверненні до сервера:",S)}}}else localStorage.getItem(s)?(x=localStorage.getItem(s),sessionStorage.setItem(c,x),sessionStorage.removeItem(s)):console.log(`Ключ "${s}" не знайдено.`);m(t.name)},j=n.useCallback(()=>{i.current&&(i.current.style.transition="all ease 0.4s",i.current.style.transform="scale(1.2)",setTimeout(()=>{i.current.style.backgroundColor="#1e1e1e",i.current.style.transform="scale(0)",setTimeout(()=>{a(F()),setTimeout(()=>{y(`${t.type}/${t.name}`)},300)},100)},400))},[y,t.name,t.type,a]);return e.jsx("div",{ref:i,className:"fileIconConteiner",onClick:s=>{s.stopPropagation(),!o&&!l?j():o&&d(s)},onBlur:()=>l&&h(`${t.type}/${t.name}`,`${t.type}/${g}`),children:!r&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{height:"70%",overflow:"hidden"},children:[e.jsx("input",{style:{pointerEvents:l?"all":"none",transition:"0.2s all ease",animation:t.name.length>16&&!l?"scrollText 6s linear infinite":"none"},onChange:p,className:`texarea fileIconName ${t.name.length>16&&"scroll-container"}`,disabled:!l,value:l?g:t.name}),e.jsx("span",{className:"fileIconType",children:t.type})]}),e.jsxs("div",{style:{display:"flex",height:"30%",alignItems:"flex-end",justifyContent:"space-between"},children:[e.jsx("div",{children:e.jsx(R,{isSelected:u.some(s=>s===`${t.type}/${g}`)})}),e.jsx("div",{style:{display:t.type==="todo"||t.type==="dashboard"||t.type===""?"flex":"none"},children:e.jsx(B,{size:1.3})})]})]})})};C.propTypes={name:N.string.isRequired,type:N.string.isRequired};const z=n.memo(C),L=({size:t,checked:r})=>e.jsx("div",{className:"selcirc",style:{height:`${t}px !important `,width:`${t}px !important `},children:e.jsx("div",{className:"selectCircle",style:{background:r?"rgb(46 46 46 )":"none"}})}),O=t=>t.replace(/[/"'\\%]/g,""),w=()=>{const t=n.useRef(null),r=b(),[l,o]=n.useState(!1),u=f(m=>m.startAnimation.value),[a,i]=n.useState({fileName:"",fileType:"note",local:!1});n.useEffect(()=>{t.current&&u&&(t.current.style.transition="all ease 0.5s",t.current.style.opacity="0%",t.current.style.transform="scale(0)")},[u]);const y=n.useCallback(m=>{const{name:d,value:p}=m.target;i(h=>({...h,[d]:O(p)}))},[]),g=n.useCallback(m=>{if(m.preventDefault(),a.fileName.trim()===""){alert("Please enter a file name");return}let d=new Date;const p=(()=>{switch(a.fileType){case"todo":return[];case"diary":return[{date:`${String(d.getDate()).padStart(2,"0")}.${String(d.getMonth()+1).padStart(2,"0")}.${d.getFullYear()}`,value:""}];case"note":return"";case"table":return[[a.fileName,""],["",""]];case"checklist":return[];case"dashboard":return{templates:[],table:[[`${String(d.getDate()).padStart(2,"0")}.${String(d.getMonth()+1).padStart(2,"0")}.${d.getFullYear()}`]]};default:return null}})(),h=JSON.stringify(p),j=`${a.fileType}/${a.fileName}`;localStorage.getItem("beLocal")!==null||a.local?localStorage.setItem(j,h):sessionStorage.setItem(j,h),o(!1),i({fileName:"",fileType:"note"}),r(v())},[a.fileName,a.fileType,a.local]);return e.jsxs("div",{onClick:()=>o(!0),ref:t,className:"fileIconConteiner addFile",style:{height:l&&300,width:l&&340},children:[e.jsxs("div",{className:"upperside",children:[e.jsx("span",{className:"fileIconName",children:"Add"}),e.jsx("div",{onBlur:()=>o(!1),onClick:m=>{m.stopPropagation(),o(d=>!d),i({fileName:"",fileType:"note"})},style:{display:"flex",height:"100%",transition:"all 0.6s ease",alignItems:"center",paddingRight:20,transform:l?"rotate(45deg)":"rotate(0deg) translateY(15px)  translateX(-20px)"},children:e.jsx(E,{color:"#D9D9D9",size:l?.8:1.5})})]}),l&&e.jsxs("form",{onSubmit:g,style:{width:"100%",marginTop:10},children:[e.jsx("input",{className:"fileName",name:"fileName",placeholder:"Name",value:a.fileName,onChange:y}),e.jsxs("select",{className:"fileType",name:"fileType",value:a.fileType,onChange:y,children:[e.jsx("option",{value:"note",children:"note"}),e.jsx("option",{value:"todo",children:"todo"}),e.jsx("option",{value:"table",children:"table"}),e.jsx("option",{value:"dashboard",children:"dashboard"}),e.jsx("option",{value:"checklist",children:"checklist"}),e.jsx("option",{value:"diary",children:"diary"})]}),e.jsxs("label",{htmlFor:"fd",className:"fileIconName",style:{fontSize:25,display:"inline-flex",alignItems:"center",justifyContent:"center"},children:["Save Locally",e.jsx("div",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",height:"100%",width:50},onClick:()=>{i({...a,local:!a.local})},children:e.jsx(L,{size:10,checked:a.local})})]}),e.jsx("button",{type:"submit",className:"submit",children:"Create"})]})]})},W=n.memo(w),Y=()=>{const t=f(o=>o.pages.value),r=f(o=>o.startAnimation.value),l=b();return n.useEffect(()=>{console.log("useef"),r&&setTimeout(()=>{l(P())},500)},[r]),e.jsx(e.Fragment,{children:e.jsx("div",{style:{width:"100%",display:"flex"},children:e.jsxs("div",{className:"desktopWithFiles",style:{height:"fit-content",background:"none"},children:[t.map((o,u)=>e.jsx(z,{name:o.split("/")[1],type:o.split("/")[0]},u)),e.jsx(W,{})]})})})},J=n.memo(Y);export{J as default};
