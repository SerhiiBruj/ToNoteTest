import{r as l,u as k,a as w,j as e,b as x,m as j,c as b,s as v,d as y}from"./index-6vMRcOZg.js";const R=()=>{const[t,n]=l.useState(!0),s=k(),r=!!localStorage.getItem("token")&&localStorage.getItem("token"),u=w(),a=l.useRef(null);l.useEffect(()=>{localStorage.getItem("beLocal")||(async()=>{if(r)try{const d=await x.get("http://"+j+":3000/authentification",{headers:{authorization:`Bearer ${r}`,clientTime:new Date().getTime()}});d.status===200&&(u(b()),u(v({userName:d.data.decoded.username,email:d.data.decoded.email,imageUrl:d.data.imageUrl})),u(y())),s("/Home")}catch{console.error("fdsfds")}})()},[]);const h=()=>{n(!t),a.current.offsetWidth===window.innerWidth*2&&(console.log("object"),a.current.style.transform==="translateX(100vw)"?a.current.style.transform="translateX(0)":a.current.style.transform="translateX(100vw)")};return e.jsxs("div",{className:"loginCenterDiv",children:[e.jsx("h1",{className:"excuseText",children:"The back-end hasn't been hosted yet, so please press the button below the form"}),e.jsxs("div",{className:"authContteiner",ref:a,children:[e.jsx(N,{navigate:s,switchSide:h}),e.jsx(C,{navigate:s,switchSide:h}),e.jsx(T,{isLoggingIn:t})]}),e.jsx("h2",{style:{color:"gray",paddingTop:20,width:"100vw",textAlign:"center",cursor:"pointer"},onClick:()=>{s("/Home"),localStorage.setItem("beLocal","1")},children:"Continue without account"})]})},C=t=>{const{navigate:n,switchSide:s}=t,[r,u]=l.useState(""),[a,h]=l.useState(""),[c,d]=l.useState(""),p=w(),[f,o]=l.useState(""),m=async i=>{if(i.preventDefault(),c.length<8?o("your password is too short"):o("your password must contein 8 symbols"),!/[a-zA-Z0-9]{4,15}/.test(r)){c.length<8?o("your password is too short"):o("your password must contein 8 symbols");return}try{const g=await x.post("http://"+j+":3000/register",{username:r,email:a,password:c,headers:{clientTime:new Date().getTime()}});console.log(g.data);const S=g.data.token;localStorage.setItem("token",S),p(v({username:r,email:a})),p(y()),n("/")}catch(g){o("Невірний логін або пароль",g.message)}};return e.jsxs("div",{className:"RegistrationCont aucont",children:[e.jsxs("form",{className:"AuthForm",onSubmit:m,children:[e.jsx("h1",{children:"Registration"}),e.jsxs("div",{children:[e.jsxs("label",{children:[e.jsx("span",{children:"Email "}),e.jsx("input",{type:"text",placeholder:"example@gmail.com",pattern:"[a-z0-9]{5,}+@[a-z]{2,}.[a-zA-Z]{2,}",value:a,onChange:i=>h(i.target.value)})]}),e.jsxs("label",{children:[e.jsx("span",{children:"Username"}),e.jsx("input",{type:"text",placeholder:"example123",value:r,onChange:i=>u(i.target.value.replace(/[\s/_]/gi,""))})]}),e.jsxs("div",{children:[e.jsxs("label",{children:[e.jsx("span",{children:"Password"}),e.jsx("input",{type:"password",placeholder:"************",value:c,onChange:i=>d(i.target.value)})]}),e.jsx("span",{style:{minHeight:"1.5em"},children:f})]})]}),e.jsx("button",{type:"submit",className:"submit",children:"Register"})]}),e.jsx("button",{className:"submit switch",onClick:s,children:"Log in"})]})},N=t=>{const{switchSide:n,navigate:s}=t,[r,u]=l.useState(""),[a,h]=l.useState(""),c=w(),[d,p]=l.useState(""),f=async o=>{o.preventDefault(),r<5&&p("The login or password is incorrect");try{const m=await x.post("http://"+j+":3000/login",{username:r,password:a,headers:{clientTime:new Date().getTime()}}),i=m.data.token;(await x.get("http://"+j+":3000/authentification",{headers:{authorization:`Bearer ${i}`,clientTime:new Date().getTime()}})).status===200&&(await I(i),c(b())),localStorage.setItem("token",i),localStorage.removeItem("beLocal"),c(v({userName:m.data.username,email:m.data.email})),c(y()),s("/Home")}catch{p("Невірний логін або пароль")}};return e.jsxs("div",{className:"logInCont aucont",children:[e.jsxs("form",{className:"AuthForm",onSubmit:f,children:[e.jsx("h1",{children:"Log In"}),e.jsx("div",{children:e.jsxs("label",{children:[e.jsx("span",{children:"Username/Email"}),e.jsx("input",{type:"text",placeholder:"example123",value:r,onChange:o=>u(o.target.value)})]})}),e.jsx("div",{children:e.jsxs("label",{children:[e.jsx("span",{children:"Password"}),e.jsx("input",{type:"password",placeholder:"************",value:a,onChange:o=>h(o.target.value)})]})}),e.jsx("span",{style:{minHeight:"1.5em"},children:d}),e.jsx("button",{className:"submit",type:"submit",children:"Log in"})]}),e.jsx("button",{className:"submit switch",id:"swtoReg",onClick:n,children:"Registration"})]})},T=({isLoggingIn:t})=>e.jsx("div",{className:"Curtain",style:{borderRadius:t?"45px 0 0 45px":"0 45px 45px 0",transform:t?"translateX(-5%)":"translateX(106%)",backgroundPositionX:t?"0%":"100%"},children:e.jsx("div",{style:{backgroundPosition:t?"60% 0%":"109% 0%"}})}),I=async t=>{try{const n=await x.get("http://"+j+":3000/get-uploaded-file",{headers:{Authorization:`Bearer ${t}`}});for(let s=0;s<n.data.userFiles.length;s++)sessionStorage.setItem(n.data.userFiles[s].name,n.data.userFiles[s].value);return!0}catch(n){return console.error(n),!1}};export{R as default};
