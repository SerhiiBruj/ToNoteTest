import{e as b,j as e,P as I,a as C,r as n,u as $,f as T,g as w,c as N,b as D,m as F,C as A}from"./index-C7DnYtfi.js";import{B as E}from"./bellsIcon-BHlIHrp9.js";const W=({isSelected:t})=>{const{isSelecting:i}=b(d=>d.select);return e.jsx("div",{className:"selcirc",style:{transform:i?"none":"scale(0)",opacity:i?1:0},children:e.jsx("div",{className:"selectCircle",style:{background:t?"rgb(46 46 46 )":"none"}})})},k=t=>{const{boolAnimate:i,setBoolAnimate:d}=t,o=b(s=>s.isEditable.value),{isSelecting:m,selected:f}=b(s=>s.select),a=C(),l=n.useRef(),y=$(),[g,u]=n.useState(t.name);n.useEffect(()=>{u(t.name)},[t.name]);const r=n.useCallback(s=>{s.stopPropagation();const c=`${t.type}/${g}`;f.includes(c)?a(w(c)):a(T(c))},[g,t.type,f]);n.useLayoutEffect(()=>{l.current&&i?(l.current.style.transition="all ease 0.5s",l.current.style.opacity="0%",l.current.style.transform="scale(0)"):(l.current.style.opacity="100%",l.current.style.transform="scale(1)")},[i]);const p=s=>{u(s.target.value)},h=async(s,c)=>{if(typeof c!="string"||!c.trim()||c===s){u(s.split("/")[1]),console.log("Новий ключ не може бути порожнім або таким самим.");return}if(Object.keys(sessionStorage).includes(c)){console.log(`Ключ "${c}" вже існує.`);return}let v=sessionStorage.getItem(s)||localStorage.getItem(s);if(v!==null)try{if(localStorage.getItem(s)&&(localStorage.setItem(c,v),localStorage.removeItem(s),a(N(Object.keys(sessionStorage)))),sessionStorage.getItem(s)){sessionStorage.setItem(c,v),sessionStorage.removeItem(s);const j=localStorage.getItem("token");if(!j){console.log("Токен не знайдено, будь ласка, увійдіть у систему.");return}if(!localStorage.getItem("beLocal"))try{const S=await D.post("http://"+F+":3000/rename-uploaded-file",{rnfile:s,newName:c},{headers:{authorization:`Bearer ${j}`}});S.status===200?(console.log("Файл успішно перейменовано"),a(N(Object.keys(sessionStorage)))):console.log("Сталася помилка при перейменуванні файлу:",S.data)}catch(S){console.error("Помилка при зверненні до сервера:",S),alert("Сталася помилка при зверненні до сервера.")}}}catch(j){console.error("Помилка при перейменуванні файлу:",j),alert("Не вдалося перейменувати файл.")}else console.log(`Ключ "${s}" не знайдено.`)},x=n.useCallback(()=>{l.current&&(l.current.style.transition="all ease 0.4s",l.current.style.transform="scale(1.2)",setTimeout(()=>{l.current.style.backgroundColor="#1e1e1e",l.current.style.transform="scale(0)",setTimeout(()=>{d(!0),setTimeout(()=>{y(`${t.type}/${t.name}`)},300)},100)},400))},[y,t.name,t.type,a]);return e.jsx("div",{ref:l,className:window.innerWidth<500?" fileIconConteinerOptim ":"fileIconConteiner",role:"button",tabIndex:0,onClick:s=>{s.stopPropagation(),!m&&!o?x():m&&r(s)},onBlur:()=>o&&h(`${t.type}/${t.name}`,`${t.type}/${g}`),children:!i&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{height:"70%",overflow:"hidden"},children:[e.jsx("input",{style:{color:"hsl(0, 0%, 20%)",pointerEvents:o?"all":"none",transition:"0.2s all ease",animation:t.name.length>16&&!o?"scrollText 6s linear infinite":"none"},onChange:p,className:`texarea fileIconName ${t.name.length>16&&"scroll-container"}`,disabled:!o,value:o?g:t.name}),e.jsx("span",{className:"fileIconType",children:t.type})]}),e.jsxs("div",{style:{display:"flex",height:"30%",alignItems:"flex-end",justifyContent:"space-between"},children:[e.jsx("div",{children:e.jsx(W,{isSelected:f.some(s=>s===`${t.type}/${g}`)})}),e.jsx("div",{style:{display:t.type==="todo"||t.type==="dashboard"||t.type===""?"flex":"none"},children:e.jsx(E,{size:1.3})})]})]})})};k.propTypes={name:I.string.isRequired,type:I.string.isRequired};const B=({size:t,checked:i})=>e.jsx("div",{className:"selcirc",style:{height:`${t}px !important `,width:`${t}px !important `},children:e.jsx("div",{className:"selectCircle",style:{background:i?"rgb(46 46 46 )":"none"}})}),O=t=>t.replace(/[/"'\\%]/g,""),P=t=>{const{boolAnimate:i}=t,d=n.useRef(null),o=C(),[m,f]=n.useState(!1),[a,l]=n.useState({fileName:"",fileType:"note",local:!1});n.useLayoutEffect(()=>{d.current&&i&&(d.current.style.transition="all ease 0.5s",d.current.style.opacity="0%",d.current.style.transform="scale(0)")},[i]);const y=n.useCallback(u=>{const{name:r,value:p}=u.target;l(h=>({...h,[r]:O(p)}))},[]),g=n.useCallback(u=>{if(u.preventDefault(),a.fileName.trim()===""){alert("Please enter a file name");return}let r=new Date;const p=(()=>{switch(a.fileType){case"todo":return[];case"diary":return[{date:`${String(r.getDate()).padStart(2,"0")}.${String(r.getMonth()+1).padStart(2,"0")}.${r.getFullYear()}`,value:""}];case"note":return"";case"table":return[[a.fileName,""],["",""]];case"checklist":return[];case"dashboard":return{templates:[],table:[[`${String(r.getDate()).padStart(2,"0")}.${String(r.getMonth()+1).padStart(2,"0")}.${r.getFullYear()}`]]};default:return null}})(),h=JSON.stringify(p),x=`${a.fileType}/${a.fileName}`;localStorage.getItem("beLocal")!==null||a.local?localStorage.setItem(x,h):sessionStorage.setItem(x,h),f(!1),l({fileName:"",fileType:"note"}),o(N())},[a.fileName,a.fileType,a.local]);return e.jsxs("div",{onClick:()=>f(!0),ref:d,className:window.innerWidth<500?"fileIconConteinerOptim addFile":"fileIconConteiner addFile",style:{backgroundColor:"#868686",height:m&&(window.innerWidth>500?350:"60dvw "),width:m&&(window.innerWidth>500?300:"50dvw")},children:[e.jsxs("div",{className:"upperside",style:{height:m&&"20%",transition:"all ease 1s"},children:[e.jsx("span",{className:"fileIconName",children:"Add"}),e.jsx("div",{onBlur:()=>f(!1),onClick:u=>{u.stopPropagation(),f(r=>!r),l({fileName:"",fileType:"note"})},style:{display:"flex",height:"100%",transition:"all 0.6s ease",alignItems:"center",paddingRight:20,transformOrigin:"center",transform:m?"rotate(45deg)  "+(window.innerWidth<500?"scale(0.3)  translateY(-40px) translateX(66%) ":"scale(0.5)"):"rotate(0deg) translateY(15px) translateX(-5%) "+(window.innerWidth<500?"scale(0.7) translateX(10%)":"")},children:e.jsx(A,{color:"#D9D9D9",size:m?.056:.08})})]}),m&&e.jsxs("form",{onSubmit:g,style:{width:"100%",marginTop:10},children:[e.jsx("input",{className:"fileName",name:"fileName",placeholder:"Name",value:a.fileName,onChange:y}),e.jsxs("select",{className:"fileType",name:"fileType",value:a.fileType,onChange:y,children:[e.jsx("option",{value:"note",children:"note"}),e.jsx("option",{value:"todo",children:"todo"}),e.jsx("option",{value:"table",children:"table"}),e.jsx("option",{value:"dashboard",children:"dashboard"}),e.jsx("option",{value:"checklist",children:"checklist"}),e.jsx("option",{value:"diary",children:"diary"})]}),e.jsxs("label",{htmlFor:"fd",className:"fileIconName",style:{fontSize:25,display:"inline-flex",alignItems:"center",justifyContent:"center"},children:["Save Locally",e.jsx("div",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",height:"100%",width:50},onClick:()=>{l({...a,local:!a.local})},children:e.jsx(B,{size:10,checked:a.local})})]}),e.jsx("button",{type:"submit",className:"submit",children:"Create"})]})]})},L=n.memo(P),R=()=>{const[t,i]=n.useState(!1),d=b(o=>o.pages.value);return n.useEffect(()=>{console.log("useEffect"),t&&setTimeout(()=>{i(!1)},500)},[t]),e.jsx("div",{className:"beforeDesktop",style:{width:"100%",height:"100%",display:"flex"},children:e.jsxs("div",{className:"desktopWithFiles",style:{height:"fit-content",background:"none"},children:[d.map((o,m)=>e.jsx(k,{setBoolAnimate:i,boolAnimate:t,name:o.split("/")[1],type:o.split("/")[0]},m)),e.jsx(L,{setBoolAnimate:i,boolAnimate:t})]})})},X=n.memo(R);export{X as default};
